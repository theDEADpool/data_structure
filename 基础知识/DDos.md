# DDos攻击
## 攻击类型
### 网络层攻击
1. ICMP flood：用于在IP主机、路由器之间传递控制消息。ICMP协议本身特点决定了它非常容易被用于攻击网络上的路由器和主机。当攻击者向目标网络发送大量的ICMP数据包时，目标主机会耗费大量的CPU资源去处理和响应，直至耗尽设备资源，无法为合法用户提供正常服务；  
2. ARP flood：攻击者通过发送大量的ARP请求，使有限的网络资源被无用的广播信息所占用，造成网络拥堵。其次，因为ARP协议没有安全认证机制，所以只要主机接收到ARP应答包，都会缓存在ARP表中，这为ARP欺骗提供了可能；  
3. IP分片攻击：IP包被人为恶意分片就会产生DDoS攻击。攻击者将经过恶意分段的数据包发送至目标网络，导致目标网络耗费大量资源进行重组，直至资源枯竭；  
### 传输层攻击
1. syn flood：攻击者通常利用工具或控制僵尸主机向服务器发送海量的变源IP地址或变源端口的SYN报文，服务器响应报文后产生大量的半连接，直至系统资源被耗尽，服务器无法提供正常的服务；  
2. ack flood：攻击者向目标服务器发送大量的ACK报文，报文带有超大载荷，会引起链路拥塞。或向目标服务器发送极高速率的变源变端口请求，导致转发设备异常，从而引起网络瘫痪；  
3. udp flood：UDP Flood攻击常用于大带宽DDoS攻击。攻击者使用包含无状态UDP协议的IP数据包充塞目标主机的端口，受害主机会寻找与UDP数据包相关的应用程序。如果没有找到，就向发送者回发一条“目标不可达”消息。一旦目标主机被攻击流量淹没，系统就会失去响应，从而造成合法用户无法正常访问的现象；   
### 应用层攻击
1. DNS flood：攻击者对目标网络发起海量域名查询请求，以中断该域的DNS解析。这种攻击将会破坏网站、API或Web应用程序响应合法流量的能力，让合法用户无法查找到用于调用特定资源的地址，导致业务暂时中断或停止；  
2. HTTP flood：通过大量get请求或Post请求导致目标机器处理能力耗尽，无法正常提供服务；   
3. CC攻击：常用于攻击提供网页访问服务的服务器。攻击者通过代理服务器向目标服务器发送大量貌似合法的请求，使CPU长时间处于高负荷运行状态，永远都有处理不完的连接。攻击会导致正常访问被中止，最终宕机崩溃；  

## 攻击特征
攻击经常来源于一些相对固定的IP或IP段，每个IP都有远大于真实用户的连接数和请求数；  
备注：这并不表明这种请求都是代表着DDOS攻击。在很多使用NAT的网络架构中，很多的客户端使用网关的IP地址访问公网资源。但是，即便如此，这样的请求数和连接数也会远少于DDOS攻击。
User-Agent通常是一个非标准的值，正常是携带浏览器信息、系统信息等；    
Referer有时是一个容易联想到攻击的值  

## 防御手段
### 硬件层面
1. 扩充带宽和硬件设备处理能力；  
2. 使用硬件防火墙；  
### 软件层面
1. 分布式集群防御，单点负载跑满可以自动切换到其他节点；  
2. 负载均衡，将流量均匀的分配到后端服务器集群上，降低单点负载；  
3. CDN流量清洗，通过CDN就近接入能力，对覆盖范围内的流量进行过滤，同时将资源缓存到边缘也可以减少中心的压力；  
### Nginx有哪些防御手段
1. 限制连接数， limit_req_zone；
2. 限制请求频率，limit_conn；  
3. 关闭慢连接，设置client_header_timeout和client_body_timeout；  
4. 设置IP白名单 or 黑名单，allow、deny；  
5. 限制到后端服务器的连接数量，max_conns可以指定到后端某个服务器的连接最大数量，queue指定了所有服务器都达到最大连接时，能够缓存的请求数量，timeout指定了连接的超时时间；  
6. 增加nginx work进程数量，增加每个work处理最大连接的数量；  
7. keepalive_requests，控制客户端可以从单个keepalive连接发出的请求数量；keepalive_timeout空闲超时时间；  
### 系统级别的配置
1. backlog大小；  
2. netdev_max_backlog进入网卡但未进入协议栈的报文队列长度；  
3. file-max扩大系统文件描述符数量限制；  
4. ip_local_port_range，扩大可用端口范围；  